# -*- coding: utf-8 -*-
import scrapy
from scrapy import Spider, Request
from bs4 import BeautifulSoup
import re
from urllib.parse import urlencode
from ..items import JobItem
class Job58Spider(scrapy.Spider):
    name = 'job'
    allowed_domains = ['58.com']
    start_urls = ["https://hf.58.com/job/","https://wuhu.58.com/job/","https://bengbu.58.com/job/","https://fy.58.com/job/","https://hn.58.com/job/","https://anqing.58.com/job/","https://suzhou.58.com/job/","https://la.58.com/job/","https://huaibei.58.com/job/","https://chuzhou.58.com/job/","https://mas.58.com/job/","https://tongling.58.com/job/","https://xuancheng.58.com/job/","https://bozhou.58.com/job/","https://huangshan.58.com/job/","https://chizhou.58.com/job/","https://ch.58.com/job/","https://hexian.58.com/job/","https://hq.58.com/job/","https://tongcheng.58.com/job/","https://ningguo.58.com/job/","https://tianchang.58.com/job/","https://dongzhi.58.com/job/","https://wuweixian.58.com/job/","https://fz.58.com/job/","https://xm.58.com/job/","https://qz.58.com/job/","https://pt.58.com/job/","https://zhangzhou.58.com/job/","https://nd.58.com/job/","https://sm.58.com/job/","https://np.58.com/job/","https://ly.58.com/job/","https://wuyishan.58.com/job/","https://shishi.58.com/job/","https://jinjiangshi.58.com/job/","https://nananshi.58.com/job/","https://longhai.58.com/job/","https://shanghangxian.58.com/job/","https://fuanshi.58.com/job/","https://fudingshi.58.com/job/","https://anxixian.58.com/job/","https://yongchunxian.58.com/job/","https://yongan.58.com/job/","https://zhangpu.58.com/job/","https://sz.58.com/job/","https://gz.58.com/job/","https://dg.58.com/job/","https://fs.58.com/job/","https://zs.58.com/job/","https://zh.58.com/job/","https://huizhou.58.com/job/","https://jm.58.com/job/","https://st.58.com/job/","https://zhanjiang.58.com/job/","https://zq.58.com/job/","https://mm.58.com/job/","https://jy.58.com/job/","https://mz.58.com/job/","https://qingyuan.58.com/job/","https://yj.58.com/job/","https://sg.58.com/job/","https://heyuan.58.com/job/","https://yf.58.com/job/","https://sw.58.com/job/","https://chaozhou.58.com/job/","https://taishan.58.com/job/","https://yangchun.58.com/job/","https://sd.58.com/job/","https://huidong.58.com/job/","https://boluo.58.com/job/","https://haifengxian.58.com/job/","https://kaipingshi.58.com/job/","https://lufengshi.58.com/job/","https://nn.58.com/job/","https://liuzhou.58.com/job/","https://gl.58.com/job/","https://yulin.58.com/job/","https://wuzhou.58.com/job/","https://bh.58.com/job/","https://gg.58.com/job/","https://qinzhou.58.com/job/","https://baise.58.com/job/","https://hc.58.com/job/","https://lb.58.com/job/","https://hezhou.58.com/job/","https://fcg.58.com/job/","https://chongzuo.58.com/job/","https://guipingqu.58.com/job/","https://beiliushi.58.com/job/","https://bobaixian.58.com/job/","https://cenxi.58.com/job/","https://gy.58.com/job/","https://zunyi.58.com/job/","https://qdn.58.com/job/","https://qn.58.com/job/","https://lps.58.com/job/","https://bijie.58.com/job/","https://tr.58.com/job/","https://anshun.58.com/job/","https://qxn.58.com/job/","https://renhuaishi.58.com/job/","https://qingzhen.58.com/job/","https://lz.58.com/job/","https://tianshui.58.com/job/","https://by.58.com/job/","https://qingyang.58.com/job/","https://pl.58.com/job/","https://jq.58.com/job/","https://zhangye.58.com/job/","https://wuwei.58.com/job/","https://dx.58.com/job/","https://jinchang.58.com/job/","https://ln.58.com/job/","https://linxia.58.com/job/","https://jyg.58.com/job/","https://gn.58.com/job/","https://dunhuang.58.com/job/","https://haikou.58.com/job/","https://sanya.58.com/job/","https://wzs.58.com/job/","https://sansha.58.com/job/","https://qh.58.com/job/","https://wenchang.58.com/job/","https://wanning.58.com/job/","https://tunchang.58.com/job/","https://qiongzhong.58.com/job/","https://lingshui.58.com/job/","https://df.58.com/job/","https://da.58.com/job/","https://cm.58.com/job/","https://baoting.58.com/job/","https://baish.58.com/job/","https://danzhou.58.com/job/","https://zz.58.com/job/","https://luoyang.58.com/job/","https://xx.58.com/job/","https://ny.58.com/job/","https://xc.58.com/job/","https://pds.58.com/job/","https://ay.58.com/job/","https://jiaozuo.58.com/job/","https://sq.58.com/job/","https://kaifeng.58.com/job/","https://puyang.58.com/job/","https://zk.58.com/job/","https://xy.58.com/job/","https://zmd.58.com/job/","https://luohe.58.com/job/","https://smx.58.com/job/","https://hb.58.com/job/","https://jiyuan.58.com/job/","https://mg.58.com/job/","https://yanling.58.com/job/","https://yuzhou.58.com/job/","https://changge.58.com/job/","https://lingbaoshi.58.com/job/","https://qixianqu.58.com/job/","https://ruzhou.58.com/job/","https://xiangchengshi.58.com/job/","https://yanshiqu.58.com/job/","https://changyuan.58.com/job/","https://huaxian.58.com/job/","https://linzhou.58.com/job/","https://qinyang.58.com/job/","https://mengzhou.58.com/job/","https://wenxian.58.com/job/","https://weishixian.58.com/job/","https://lankaoxian.58.com/job/","https://tongxuxian.58.com/job/","https://lyxinan.58.com/job/","https://yichuan.58.com/job/","https://mengjinqu.58.com/job/","https://lyyiyang.58.com/job/","https://wugang.58.com/job/","https://yongcheng.58.com/job/","https://suixian.58.com/job/","https://luyi.58.com/job/","https://yingchixian.58.com/job/","https://shenqiu.58.com/job/","https://taikang.58.com/job/","https://shangshui.58.com/job/","https://qixianq.58.com/job/","https://junxian.58.com/job/","https://fanxian.58.com/job/","https://gushixian.58.com/job/","https://huaibinxian.58.com/job/","https://dengzhou.58.com/job/","https://xinye.58.com/job/","https://hrb.58.com/job/","https://dq.58.com/job/","https://qqhr.58.com/job/","https://mdj.58.com/job/","https://suihua.58.com/job/","https://jms.58.com/job/","https://jixi.58.com/job/","https://sys.58.com/job/","https://hegang.58.com/job/","https://heihe.58.com/job/","https://yich.58.com/job/","https://qth.58.com/job/","https://dxal.58.com/job/","https://shanda.58.com/job/","https://shzhaodong.58.com/job/","https://zhaozhou.58.com/job/","https://wh.58.com/job/","https://yc.58.com/job/","https://xf.58.com/job/","https://jingzhou.58.com/job/","https://shiyan.58.com/job/","https://hshi.58.com/job/","https://xiaogan.58.com/job/","https://hg.58.com/job/","https://es.58.com/job/","https://jingmen.58.com/job/","https://xianning.58.com/job/","https://ez.58.com/job/","https://suizhou.58.com/job/","https://qianjiang.58.com/job/","https://tm.58.com/job/","https://xiantao.58.com/job/","https://snj.58.com/job/","https://yidou.58.com/job/","https://hanchuan.58.com/job/","https://zaoyang.58.com/job/","https://wuxueshi.58.com/job/","https://zhongxiangshi.58.com/job/","https://jingshanxian.58.com/job/","https://shayangxian.58.com/job/","https://songzi.58.com/job/","https://guangshuishi.58.com/job/","https://chibishi.58.com/job/","https://laohekou.58.com/job/","https://gucheng.58.com/job/","https://yichengshi.58.com/job/","https://nanzhang.58.com/job/","https://yunmeng.58.com/job/","https://anlu.58.com/job/","https://dawu.58.com/job/","https://xiaochang.58.com/job/","https://dangyang.58.com/job/","https://zhijiang.58.com/job/","https://jiayuxian.58.com/job/","https://suixia.58.com/job/","https://cs.58.com/job/","https://zhuzhou.58.com/job/","https://yiyang.58.com/job/","https://changde.58.com/job/","https://hy.58.com/job/","https://xiangtan.58.com/job/","https://yy.58.com/job/","https://chenzhou.58.com/job/","https://shaoyang.58.com/job/","https://hh.58.com/job/","https://yongzhou.58.com/job/","https://ld.58.com/job/","https://xiangxi.58.com/job/","https://zjj.58.com/job/","https://liling.58.com/job/","https://lixian.58.com/job/","https://czguiyang.58.com/job/","https://zixing.58.com/job/","https://yongxing.58.com/job/","https://changningshi.58.com/job/","https://qidongxian.58.com/job/","https://hengdong.58.com/job/","https://lengshuijiangshi.58.com/job/","https://lianyuanshi.58.com/job/","https://shuangfengxian.58.com/job/","https://shaoyangxian.58.com/job/","https://shaodongxian.58.com/job/","https://yuanjiangs.58.com/job/","https://nanxian.58.com/job/","https://qiyang.58.com/job/","https://xiangyin.58.com/job/","https://huarong.58.com/job/","https://cilixian.58.com/job/","https://zzyouxian.58.com/job/","https://sjz.58.com/job/","https://bd.58.com/job/","https://ts.58.com/job/","https://lf.58.com/job/","https://hd.58.com/job/","https://qhd.58.com/job/","https://cangzhou.58.com/job/","https://xt.58.com/job/","https://hs.58.com/job/","https://zjk.58.com/job/","https://chengde.58.com/job/","https://dingzhou.58.com/job/","https://gt.58.com/job/","https://zhangbei.58.com/job/","https://zx.58.com/job/","https://zd.58.com/job/","https://qianan.58.com/job/","https://renqiu.58.com/job/","https://sanhe.58.com/job/","https://wuan.58.com/job/","https://xionganxinqu.58.com/job/","https://lfyanjiao.58.com/job/","https://zhuozhou.58.com/job/","https://hejian.58.com/job/","https://huanghua.58.com/job/","https://cangxian.58.com/job/","https://cixian.58.com/job/","https://shexian.58.com/job/","https://bazhou.58.com/job/","https://xianghe.58.com/job/","https://lfguan.58.com/job/","https://zunhua.58.com/job/","https://qianxixian.58.com/job/","https://yutianxian.58.com/job/","https://luannanxian.58.com/job/","https://shaheshi.58.com/job/","https://su.58.com/job/","https://nj.58.com/job/","https://wx.58.com/job/","https://cz.58.com/job/","https://xz.58.com/job/","https://nt.58.com/job/","https://yz.58.com/job/","https://yancheng.58.com/job/","https://ha.58.com/job/","https://lyg.58.com/job/","https://taizhou.58.com/job/","https://suqian.58.com/job/","https://zj.58.com/job/","https://shuyang.58.com/job/","https://dafeng.58.com/job/","https://rugao.58.com/job/","https://qidong.58.com/job/","https://liyang.58.com/job/","https://haimen.58.com/job/","https://donghai.58.com/job/","https://yangzhong.58.com/job/","https://xinghuashi.58.com/job/","https://xinyishi.58.com/job/","https://taixing.58.com/job/","https://rudong.58.com/job/","https://pizhou.58.com/job/","https://xzpeixian.58.com/job/","https://jingjiang.58.com/job/","https://jianhu.58.com/job/","https://haian.58.com/job/","https://dongtai.58.com/job/","https://danyang.58.com/job/","https://baoyingx.58.com/job/","https://guannan.58.com/job/","https://guanyun.58.com/job/","https://jiangyan.58.com/job/","https://jintan.58.com/job/","https://szkunshan.58.com/job/","https://sihong.58.com/job/","https://siyang.58.com/job/","https://jurong.58.com/job/","https://sheyang.58.com/job/","https://funingxian.58.com/job/","https://xiangshui.58.com/job/","https://xuyi.58.com/job/","https://jinhu.58.com/job/","https://jiangyins.58.com/job/","https://nc.58.com/job/","https://ganzhou.58.com/job/","https://jj.58.com/job/","https://yichun.58.com/job/","https://ja.58.com/job/","https://sr.58.com/job/","https://px.58.com/job/","https://fuzhou.58.com/job/","https://jdz.58.com/job/","https://xinyu.58.com/job/","https://yingtan.58.com/job/","https://yxx.58.com/job/","https://lepingshi.58.com/job/","https://jinxian.58.com/job/","https://fenyi.58.com/job/","https://fengchengshi.58.com/job/","https://zhangshu.58.com/job/","https://gaoan.58.com/job/","https://yujiang.58.com/job/","https://nanchengx.58.com/job/","https://fuliangxian.58.com/job/","https://cc.58.com/job/","https://jl.58.com/job/","https://sp.58.com/job/","https://yanbian.58.com/job/","https://songyuan.58.com/job/","https://bc.58.com/job/","https://th.58.com/job/","https://baishan.58.com/job/","https://liaoyuan.58.com/job/","https://gongzhuling.58.com/job/","https://meihekou.58.com/job/","https://fuyuxian.58.com/job/","https://changlingxian.58.com/job/","https://huadian.58.com/job/","https://panshi.58.com/job/","https://lishu.58.com/job/","https://sy.58.com/job/","https://dl.58.com/job/","https://as.58.com/job/","https://jinzhou.58.com/job/","https://fushun.58.com/job/","https://yk.58.com/job/","https://pj.58.com/job/","https://cy.58.com/job/","https://dandong.58.com/job/","https://liaoyang.58.com/job/","https://benxi.58.com/job/","https://hld.58.com/job/","https://tl.58.com/job/","https://fx.58.com/job/","https://pld.58.com/job/","https://wfd.58.com/job/","https://dengta.58.com/job/","https://fengcheng.58.com/job/","https://beipiao.58.com/job/","https://kaiyuan.58.com/job/","https://yinchuan.58.com/job/","https://wuzhong.58.com/job/","https://szs.58.com/job/","https://zw.58.com/job/","https://guyuan.58.com/job/","https://hu.58.com/job/","https://bt.58.com/job/","https://chifeng.58.com/job/","https://erds.58.com/job/","https://tongliao.58.com/job/","https://hlbe.58.com/job/","https://bycem.58.com/job/","https://wlcb.58.com/job/","https://xl.58.com/job/","https://xam.58.com/job/","https://wuhai.58.com/job/","https://alsm.58.com/job/","https://hlr.58.com/job/","https://xn.58.com/job/","https://hx.58.com/job/","https://haibei.58.com/job/","https://guoluo.58.com/job/","https://haidong.58.com/job/","https://huangnan.58.com/job/","https://ys.58.com/job/","https://hainan.58.com/job/","https://geermushi.58.com/job/","https://qd.58.com/job/","https://jn.58.com/job/","https://yt.58.com/job/","https://wf.58.com/job/","https://linyi.58.com/job/","https://zb.58.com/job/","https://jining.58.com/job/","https://ta.58.com/job/","https://lc.58.com/job/","https://weihai.58.com/job/","https://zaozhuang.58.com/job/","https://dz.58.com/job/","https://rizhao.58.com/job/","https://dy.58.com/job/","https://heze.58.com/job/","https://bz.58.com/job/","https://lw.58.com/job/","https://zhangqiu.58.com/job/","https://kl.58.com/job/","https://zc.58.com/job/","https://shouguang.58.com/job/","https://longkou.58.com/job/","https://caoxian.58.com/job/","https://shanxian.58.com/job/","https://feicheng.58.com/job/","https://gaomi.58.com/job/","https://guangrao.58.com/job/","https://huantaixian.58.com/job/","https://juxian.58.com/job/","https://laizhou.58.com/job/","https://penglai.58.com/job/","https://qingzhou.58.com/job/","https://rongcheng.58.com/job/","https://rushan.58.com/job/","https://tengzhou.58.com/job/","https://xintai.58.com/job/","https://zhaoyuan.58.com/job/","https://zoucheng.58.com/job/","https://zouping.58.com/job/","https://linqing.58.com/job/","https://chiping.58.com/job/","https://hzyc.58.com/job/","https://boxing.58.com/job/","https://dongming.58.com/job/","https://juye.58.com/job/","https://wudi.58.com/job/","https://qihe.58.com/job/","https://weishan.58.com/job/","https://yuchengshi.58.com/job/","https://linyixianq.58.com/job/","https://leling.58.com/job/","https://laiyang.58.com/job/","https://ningjin.58.com/job/","https://gaotang.58.com/job/","https://shenxian.58.com/job/","https://yanggu.58.com/job/","https://guanxian.58.com/job/","https://pingyi.58.com/job/","https://tancheng.58.com/job/","https://yiyuanxian.58.com/job/","https://wenshang.58.com/job/","https://liangshanx.58.com/job/","https://lijin.58.com/job/","https://yinanxian.58.com/job/","https://qixia.58.com/job/","https://ningyang.58.com/job/","https://dongping.58.com/job/","https://changyishi.58.com/job/","https://anqiu.58.com/job/","https://changle.58.com/job/","https://linqu.58.com/job/","https://juancheng.58.com/job/","https://ty.58.com/job/","https://linfen.58.com/job/","https://dt.58.com/job/","https://yuncheng.58.com/job/","https://jz.58.com/job/","https://changzhi.58.com/job/","https://jincheng.58.com/job/","https://yq.58.com/job/","https://lvliang.58.com/job/","https://xinzhou.58.com/job/","https://shuozhou.58.com/job/","https://linyixian.58.com/job/","https://qingxu.58.com/job/","https://liulin.58.com/job/","https://gaoping.58.com/job/","https://zezhou.58.com/job/","https://xiangyuanxian.58.com/job/","https://xiaoyi.58.com/job/","https://xa.58.com/job/","https://xianyang.58.com/job/","https://baoji.58.com/job/","https://wn.58.com/job/","https://hanzhong.58.com/job/","https://yl.58.com/job/","https://yanan.58.com/job/","https://ankang.58.com/job/","https://sl.58.com/job/","https://tc.58.com/job/","https://shenmu.58.com/job/","https://hancheng.58.com/job/","https://fugu.58.com/job/","https://jingbian.58.com/job/","https://dingbian.58.com/job/","https://cd.58.com/job/","https://mianyang.58.com/job/","https://deyang.58.com/job/","https://nanchong.58.com/job/","https://yb.58.com/job/","https://zg.58.com/job/","https://ls.58.com/job/","https://luzhou.58.com/job/","https://dazhou.58.com/job/","https://scnj.58.com/job/","https://suining.58.com/job/","https://panzhihua.58.com/job/","https://ms.58.com/job/","https://ga.58.com/job/","https://zy.58.com/job/","https://liangshan.58.com/job/","https://guangyuan.58.com/job/","https://ya.58.com/job/","https://bazhong.58.com/job/","https://ab.58.com/job/","https://ganzi.58.com/job/","https://anyuexian.58.com/job/","https://guanghanshi.58.com/job/","https://jianyangshi.58.com/job/","https://renshouxian.58.com/job/","https://shehongxian.58.com/job/","https://dazu.58.com/job/","https://xuanhan.58.com/job/","https://qux.58.com/job/","https://changningx.58.com/job/","https://xj.58.com/job/","https://changji.58.com/job/","https://bygl.58.com/job/","https://yili.58.com/job/","https://aks.58.com/job/","https://ks.58.com/job/","https://hami.58.com/job/","https://klmy.58.com/job/","https://betl.58.com/job/","https://tlf.58.com/job/","https://ht.58.com/job/","https://shz.58.com/job/","https://kzls.58.com/job/","https://ale.58.com/job/","https://wjq.58.com/job/","https://tmsk.58.com/job/","https://kel.58.com/job/","https://alt.58.com/job/","https://tac.58.com/job/","https://lasa.58.com/job/","https://rkz.58.com/job/","https://sn.58.com/job/","https://linzhi.58.com/job/","https://changdu.58.com/job/","https://nq.58.com/job/","https://al.58.com/job/","https://rituxian.58.com/job/","https://gaizexian.58.com/job/","https://km.58.com/job/","https://qj.58.com/job/","https://dali.58.com/job/","https://honghe.58.com/job/","https://yx.58.com/job/","https://lj.58.com/job/","https://ws.58.com/job/","https://cx.58.com/job/","https://bn.58.com/job/","https://zt.58.com/job/","https://dh.58.com/job/","https://pe.58.com/job/","https://bs.58.com/job/","https://lincang.58.com/job/","https://diqing.58.com/job/","https://nujiang.58.com/job/","https://milexian.58.com/job/","https://anningshi.58.com/job/","https://xuanwushi.58.com/job/","https://hz.58.com/job/","https://nb.58.com/job/","https://wz.58.com/job/","https://jh.58.com/job/","https://jx.58.com/job/","https://tz.58.com/job/","https://sx.58.com/job/","https://huzhou.58.com/job/","https://lishui.58.com/job/","https://quzhou.58.com/job/","https://zhoushan.58.com/job/","https://yueqingcity.58.com/job/","https://ruiancity.58.com/job/","https://yiwu.58.com/job/","https://yuyao.58.com/job/","https://zhuji.58.com/job/","https://xiangshanxian.58.com/job/","https://wenling.58.com/job/","https://tongxiang.58.com/job/","https://cixi.58.com/job/","https://changxing.58.com/job/","https://jiashanx.58.com/job/","https://haining.58.com/job/","https://deqing.58.com/job/","https://dongyang.58.com/job/","https://anji.58.com/job/","https://cangnanxian.58.com/job/","https://linhai.58.com/job/","https://yongkang.58.com/job/","https://yuhuan.58.com/job/","https://pinghushi.58.com/job/","https://haiyan.58.com/job/","https://wuyix.58.com/job/","https://shengzhou.58.com/job/","https://xinchang.58.com/job/","https://jiangshanshi.58.com/job/","https://pingyangxian.58.com/job/","https://hk.58.com/job/","https://am.58.com/job/","https://tw.58.com/job/"]

    def parse(self, response):#第一页解析+翻页
        urls = response.xpath("//li[contains(@class,'job_item')]/div[contains(@class,'job_title')]//a/@href").extract()
        for url in urls:
            yield Request(url,callback=self.parse_detail)
            
        total_page = response.xpath("//i[contains(@class,'total_page')]/text()").extract()[0]
        for i in range(2,int(total_page)+1):
            url = response.url+'pn'+str(i)+'/'
            yield Request(url,callback=self.parse_nextpage)

    def parse_nextpage(self,response):#第二页以后的解析
        urls = response.xpath("//li[contains(@class,'job_item')]/div[contains(@class,'job_title')]//a/@href").extract()
        for url in urls:
            yield Request(url,callback=self.parse_detail)

    def parse_detail(self,response):
        soup = BeautifulSoup(response.body, 'lxml')
        item = JobItem()
        job = soup.select('.pos_title')
        company = soup.select('.baseInfo_link')
        salery = soup.select('.pos_salary')
        message_1 = soup.select('.pos_base_condition')
        message_2 = soup.select('.pos_welfare')
        message_job1 = soup.select('.des')
        message_job2 = soup.select('.pos_name')
        message_company = soup.select('.shiji')
        place = soup.select('.pos-area')
        message_company2_1 = soup.select('.pass_identify')
        message_company2_2 = soup.select('.comp_baseInfo_scale')
        message_company2_3 = soup.select('.comp_baseInfo_belong')
        if place:
            item['place'] = place[0].get_text("|", strip=True).replace('|查看地图', '')
        if job:
            item['job'] = job[0].get_text("|", strip=True)
        if company:
            item['company'] = company[0].get_text("|", strip=True)
        if salery:
            item['salery'] = salery[0].get_text("|", strip=True).replace('|', ' ')  # 上面获取的salery表单第一个为广告 第二个为需要的数据
        if message_1:
            item['message_1'] = message_1[0].get_text("|", strip=True).replace('|||', ' | ')
        if message_2:
            item['message_2'] = message_2[0].get_text("|", strip=True).replace('|', ' ')
        if message_job1:
            item['message_job1'] = message_job1[0].get_text("|", strip=True).replace('|', '')
        if message_job2:
            item['message_job2'] = message_job2[0].get_text("|", strip=True).replace('|', '')
        if message_company:
            item['message_company'] = message_company[0].get_text("|", strip=True).replace('|', '')
        if message_company2_1:
            item['message_company2_1'] = message_company2_1[0].get_text("|", strip=True).replace('|', '')
        if message_company2_2:
            item['message_company2_2'] = message_company2_2[0].get_text("|", strip=True).replace('|', '')
        if message_company2_3:
            item['message_company2_3'] = message_company2_3[0].get_text("|", strip=True).replace('|', '')

        yield item

